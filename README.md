# Pastebin Clone

## Описание

Этот проект представляет собой клон популярного сервиса Pastebin, предназначенного для хранения и обмена текстовыми блоками.  
Проект создан для практики разработки современных микросервисных приложений с использованием Python и связанных технологий.

Пользователь может:
1. Создать текстовый блок с временным сроком хранения.
2. Получить уникальную короткую ссылку для доступа к тексту.
3. Поделиться ссылкой с другими.
4. Указать срок жизни текста (TTL), после которого он автоматически удаляется.

---

## Архитектура

Проект следует микросервисной архитектуре и включает следующие компоненты:
- **NGINX (Load Balancer):** обеспечивает распределение запросов между сервисами.
- **FastAPI:** основа API-сервиса.
- **Redis:** используется как кэш для ускорения доступа к часто запрашиваемым данным.
- **Google Cloud Storage:** хранилище для текстовых данных.
- **PostgreSQL:** база данных для хранения метаданных (ссылки, TTL, статистика).
- **Celery:** выполняет фоновые задачи, такие как очистка истёкших данных.
- **Prometheus + Grafana:** система мониторинга и визуализации.

Подробное описание архитектуры можно найти в документе [architecture_document.md](./architecture_document.md).

---

## Установка и запуск

### Предварительные требования

- Python 3.9+
- Redis
- PostgreSQL
- Google Cloud Storage (учётная запись и bucket)
- Docker (для запуска NGINX, Prometheus, Grafana)

### Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/your-username/pastebin-clone.git
   cd pastebin-clone
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Настройте переменные окружения:
   Создайте файл `.env` и заполните его следующими параметрами:
   ```
   DATABASE_URL=postgresql://user:password@localhost:5432/pastebin
   REDIS_URL=redis://localhost:6379/0
   GOOGLE_CLOUD_BUCKET=my-bucket
   GOOGLE_APPLICATION_CREDENTIALS=/path/to/credentials.json
   ```

4. Запустите PostgreSQL, Redis и другие необходимые сервисы.

5. Инициализируйте базу данных:
   ```bash
   python scripts/init_db.py
   ```

6. Запустите проект:
   ```bash
   uvicorn app.main:app --reload
   ```

7. Для фоновых задач запустите Celery:
   ```bash
   celery -A app.tasks worker --loglevel=info
   ```

8. (Опционально) Запустите мониторинг:
   - Prometheus и Grafana можно поднять с помощью Docker:
     ```bash
     docker-compose up -d
     ```

---

## Использование

### Эндпоинты API

1. **Создание текста**
   - `POST /create`
   - Тело запроса:
     ```json
     {
       "content": "Ваш текст",
       "ttl": "1d"  // Время жизни текста (например, 1d, 2h)
     }
     ```
   - Пример ответа:
     ```json
     {
       "url": "https://example.com/<hash>"
     }
     ```

2. **Получение текста**
   - `GET /<hash>`
   - Пример ответа:
     ```json
     {
       "content": "Ваш текст"
     }
     ```

3. **Ошибка истечения TTL**
   - Пример ответа:
     ```json
     {
       "error": "This text has expired."
     }
     ```

---

## Технологический стек

- **Язык программирования:** Python
- **API:** FastAPI
- **База данных:** PostgreSQL
- **Кэш:** Redis
- **Хранилище данных:** Google Cloud Storage
- **Фоновые задачи:** Celery
- **Балансировка нагрузки:** NGINX
- **Мониторинг:** Prometheus + Grafana

---

## Лицензия

Этот проект распространяется под лицензией MIT. Полный текст лицензии можно найти в файле [LICENSE](./LICENSE).

---

## Документация

- **Архитектура:** [architecture_document.md](./architecture_document.md)
- **Лицензия:** [LICENSE](./LICENSE)

---

## Вклад в проект

Вы можете свободно использовать и модифицировать этот проект. Если у вас есть предложения по улучшению, открывайте Issue или делайте Pull Request.
