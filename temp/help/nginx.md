NGINX — это веб-сервер, который может работать как **обратный прокси-сервер**, **балансировщик нагрузки**, а также сервер для раздачи статических файлов. Он известен своей высокой производительностью, низким потреблением ресурсов и гибкостью настройки.

---

### **Как работает NGINX?**
1. **Входящий запрос**: Когда пользователь отправляет HTTP-запрос (например, открывает сайт в браузере), запрос сначала попадает на NGINX. 
   
2. **Обработка**: NGINX решает, что делать с этим запросом:
   - Может обслужить запрос сам (например, отдавая статические файлы, такие как HTML, CSS, изображения).
   - Может перенаправить запрос на другой сервер (обратный прокси).
   - Может балансировать запросы между несколькими серверами (балансировщик нагрузки).

3. **Ответ**: После обработки запроса NGINX возвращает ответ пользователю.

---

### **Что делает наш конфиг NGINX?**

Теперь разберём файл конфигурации по частям.

#### **1. Общие настройки**

```nginx
worker_processes auto;

events {
    worker_connections 1024;
}
```

- **`worker_processes auto;`**: Указывает количество процессов, которые будет использовать NGINX. `auto` автоматически настраивает количество процессов в зависимости от количества ядер процессора, что помогает NGINX масштабироваться на многопоточных системах.
  
- **`worker_connections 1024;`**: Определяет, сколько соединений может одновременно обрабатывать каждый процесс. Например, с 4 процессами сервер сможет обрабатывать до 4096 соединений одновременно.

---

#### **2. HTTP-блок — работа с запросами**

```nginx
http {
    include       mime.types;
    default_type  application/octet-stream;

    # Улучшение производительности
    sendfile        on;
    tcp_nopush      on;
    tcp_nodelay     on;

    keepalive_timeout  65;
```

- **`http { ... }`**: В этом блоке описываются настройки для работы с HTTP-запросами.

- **`include mime.types;`**: Подключает файл `mime.types`, который определяет типы файлов (например, `.html`, `.css`, `.jpg`), чтобы браузеры знали, как их обрабатывать.

- **`default_type application/octet-stream;`**: Устанавливает тип содержимого по умолчанию (если NGINX не знает, что это за файл). `application/octet-stream` говорит браузеру, что это двоичный файл.

- **Настройки производительности:**
  - **`sendfile on;`**: Ускоряет передачу файлов, используя операционную систему для обработки запроса.
  - **`tcp_nopush on;`**: Уменьшает задержку при передаче данных.
  - **`tcp_nodelay on;`**: Ускоряет передачу мелких пакетов.
  - **`keepalive_timeout 65;`**: Устанавливает таймаут для соединений (в секундах). Если клиент не отправляет запросы за это время, соединение закрывается.

---

#### **3. Настройка `upstream` — группы серверов**

```nginx
    upstream api {
        server api:8000;
    }

    upstream hash_generator {
        server hash-generator:8001;
    }
```

- **`upstream`**: Определяет группу серверов, к которым NGINX может проксировать запросы.
  - **`api`** и **`hash_generator`** — это имена групп серверов. Эти имена потом используются в других частях конфигурации.
  - **`server api:8000;`** и **`server hash-generator:8001;`**: Указывают адреса серверов, которые обрабатывают запросы. В данном случае `api` и `hash-generator` — это названия сервисов в Docker Compose, а порты 8000 и 8001 — их точки входа.

---

#### **4. Настройка `server` — поведение при запросах**

```nginx
    server {
        listen 80;

        location /api/ {
            proxy_pass http://api;
        }

        location /hash/ {
            proxy_pass http://hash_generator;
        }
    }
```

- **`server { ... }`**: Этот блок описывает поведение сервера для обработки входящих запросов.
  
- **`listen 80;`**: Указывает, что сервер будет слушать HTTP-запросы на порту 80 (стандартный порт для HTTP).

- **`location`**: Задает правила для обработки запросов.
  - **`/api/`**: Если запрос начинается с `/api/`, то NGINX отправляет его на `http://api` (сервис API, описанный в `upstream api`).
  - **`/hash/`**: Если запрос начинается с `/hash/`, то NGINX отправляет его на `http://hash_generator`.

- **`proxy_pass`**: Указывает, куда перенаправлять запросы. Здесь NGINX выступает как прокси-сервер, передавая запросы другим сервисам.

---

### **Что происходит в вашем проекте?**

1. Клиент отправляет запрос:
   - На `http://ваш_сервер/api/` — запрос попадает в API (сервис на порту 8000).
   - На `http://ваш_сервер/hash/` — запрос попадает в Hash Generator (сервис на порту 8001).

2. NGINX получает запрос, смотрит на `location`, определяет правило и перенаправляет запрос.

3. API или Hash Generator обрабатывают запрос и возвращают результат, который NGINX передаёт обратно клиенту.

---

### **Ключевые преимущества NGINX**
- **Балансировка нагрузки**: Если добавить несколько серверов в `upstream`, NGINX будет распределять запросы между ними.
- **Обратное проксирование**: NGINX скрывает внутренние сервисы от внешнего мира, выполняя роль посредника.
- **Масштабируемость**: NGINX легко обрабатывает тысячи запросов в секунду.
- **Гибкость конфигурации**: Вы можете настроить практически любые сценарии обработки запросов.

---

### Смотрите также официальный источник - https://nginx.org/ru/